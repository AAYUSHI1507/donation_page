<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Include necessary scripts and stylesheets -->

    <!-- <script src="script.js"></script> -->
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
  </head>
  <body>
    <header>
      <h1>Donate to Our Cause</h1>
    </header>
    <main>
      <section class="donation-section">
        <h2>Make a Donation</h2>
        <p>Select an amount and click the "Donate" button:</p>
        <form id="donation-form" method="post">
          <div class="amount">
            <label for="amount">Amount (in INR):</label>
            <input type="number" id="amount" name="amount" required />
          </div>
          <button type="button" id="donate-button">Donate</button>
        </form>
      </section>
    </main>
    <footer>
      <p>&copy; 2023 Donation Website</p>
    </footer>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <script>
      const amountInput = document.getElementById("amount");
      const donateButton = document.getElementById("donate-button");
      let orderId;

      // Event handler for the "Donate" button
      donateButton.onclick = function (e) {
        const amount = parseFloat(amountInput.value);
        if (isNaN(amount) || amount <= 0) {
          alert("Please enter a valid donation amount.");
          return;
        }

        // Create an order and obtain the order ID
        $.ajax({
          url: "/create/orderId",
          method: "POST",
          contentType: "application/json",
          data: JSON.stringify({
            amount: `${amount * 100}`,
          }),
          success: function (response) {
            orderId = response.orderId;
            console.log(orderId);

            // Initialize Razorpay payment with the obtained order ID
            var options = {
              key: "rzp_test_88DlPF9rFIOul7", // Replace with your Razorpay Key ID
              amount: `${amount * 100}`,
              currency: "INR",
              name: "AK ENTERPRISES",
              description: "Test Transaction",
              image: "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.istockphoto.com%2Fillustrations%2Flock-logo&psig=AOvVaw3d8SPJlmO66nPl59NMlBAX&ust=1694473407161000&source=images&cd=vfe&opi=89978449&ved=0CBAQjRxqFwoTCMj3wL2ToYEDFQAAAAAdAAAAABAE", // Replace with your image URL
              order_id: orderId,
              handler: function (response) {
                alert(response.razorpay_payment_id);
                alert(response.razorpay_order_id);
                alert(response.razorpay_signature);
              },
              theme: {
                color: "#3399cc",
              },
            };

            var rzp1 = new Razorpay(options);
            rzp1.on("payment.failed", function (response) {
              // Handle payment failure here
              console.log(response.error);
              alert(response.error.code);
              alert(response.error.description);
              // Add more error handling as needed
            });

            rzp1.open();
          },
          error: function (error) {
            // Handle error from order creation AJAX request
            console.error(error);
            alert("Order creation failed.");
          },
        });

        e.preventDefault();
      };
    </script>
  </body>
</html>
